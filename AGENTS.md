# Decart SDK - Coding Agent Guidelines

## Build/Test Commands
- `pnpm build` - Build the project using tsdown
- `pnpm dev` - Watch mode for development  
- `pnpm dev:example` - Run Vite dev server for examples
- `pnpm test` - Run all tests with Vitest
- `pnpm test tests/specific.test.ts` - Run a single test file
- `pnpm typecheck` - Type check with TypeScript (no emit)
- `pnpm format` - Format code with Biome
- `pnpm release` - Bump version and publish to NPM

## Project Architecture
- **src/index.ts** - Main entry point, exports createDecartClient with realtime and process clients
- **src/process/** - HTTP API for asynchronous video/image generation
  - `client.ts` - Process client implementation for model inference
  - `request.ts` - HTTP request handling and file input processing
  - `types.ts` - TypeScript types for process API options
- **src/realtime/** - WebRTC real-time video streaming logic
  - `client.ts` - Real-time client implementation with WebRTC connection management
  - `webrtc-manager.ts` - WebRTC connection lifecycle and signaling
  - `webrtc-connection.ts` - Low-level WebRTC peer connection handling
  - `methods.ts` - WebRTC method implementations
  - `types.ts` - TypeScript types for WebRTC messages and events
- **src/shared/** - Shared model definitions and types
  - `model.ts` - Model registry with definitions for realtime, video, and image models
  - `types.ts` - Common types across APIs (ModelState, etc.)
- **src/utils/** - Shared utilities
  - `errors.ts` - Error factory pattern with ERROR_CODES constants
- **tests/** - Test files using Vitest (.test.ts extension)
- **dist/** - Build output (gitignored, generated by tsdown)

## Code Style & Conventions
- **TypeScript**: Strict mode, no unused locals, verbatimModuleSyntax enabled
- **Module System**: ESM only (`type: "module"`), platform neutral builds via tsdown
- **Build Tool**: tsdown with unbundle mode for better tree-shaking
- **Testing**: Vitest for unit tests
- **Imports**: Named exports preferred, use `export type` for types, no file extensions needed
- **Error Handling**: Use error factory pattern (createSDKError), include ERROR_CODES constants
- **Validation**: Use Zod schemas for runtime validation (e.g., decartClientOptionsSchema)
- **WebRTC**: Implement proper connection lifecycle with error recovery
- **Events**: Use mitt for typed event emitters (connection state, errors)
- **Formatting**: Use Biome formatter (`pnpm format`), enforced formatting standards
- **Dependencies**: 
  - Runtime: mitt (events), p-retry (resilience), uuid (unique IDs), zod (validation)
  - Dev: tsdown (build), vitest (test), typescript, vite (examples), bumpp (releases)

## API Design Patterns
- **Factory Functions**: Use `create*` pattern for constructors (createDecartClient, createRealTimeClient, createProcessClient)
- **Options Validation**: Validate all public API options with Zod schemas
- **Error Messages**: Provide clear, actionable error messages with specific error codes
- **Type Exports**: Export all public types alongside implementations
- **Model Registry**: Use `models.realtime()`, `models.video()`, `models.image()` factory functions to access model definitions
- **File Inputs**: Support multiple input types (File, Blob, ReadableStream, URL, string URL)

## Supported Models
### Realtime Models (WebRTC)
- `mirage` - Real-time video restyling model
- `mirage_v2` - Real-time video restyling model (v2)
- `lucy_v2v_720p_rt` - Real-time video editing model

### Video Models (Process API)
- `lucy-dev-i2v` - image-to-video (Dev quality)
- `lucy-fast-v2v` - video-to-video (Fast quality)
- `lucy-pro-t2v` - text-to-video (Pro quality)
- `lucy-pro-i2v` - image-to-video (Pro quality)
- `lucy-pro-v2v` - video-to-video (Pro quality)
- `lucy-pro-flf2v` - first-last-frame-to-video (Pro quality)

### Image Models (Process API)
- `lucy-pro-t2i` - text-to-image (Pro quality)
- `lucy-pro-i2i` - image-to-image (Pro quality)
