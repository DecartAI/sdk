# Mirage SDK - Coding Agent Guidelines

## Build/Test Commands
- `pnpm build` - Build the project using tsdown
- `pnpm dev` - Watch mode for development  
- `pnpm dev:example` - Run Vite dev server for examples
- `pnpm test` - Run all tests with Vitest
- `pnpm test tests/specific.test.ts` - Run a single test file
- `pnpm typecheck` - Type check with TypeScript (no emit)
- `pnpm format` - Format code with Biome
- `pnpm release` - Bump version and publish to NPM

## Project Architecture
- **src/index.ts** - Main entry point, exports createMirageClient
- **src/realtime/** - WebRTC real-time video streaming logic
  - `client.ts` - Real-time client implementation with WebRTC connection management
  - `webrtc-manager.ts` - WebRTC connection lifecycle and signaling
  - `webrtc-connection.ts` - Low-level WebRTC peer connection handling
  - `types.ts` - TypeScript types for WebRTC messages and events
- **src/utils/** - Shared utilities
  - `errors.ts` - Error factory pattern with ERROR_CODES constants
- **tests/** - Test files using Vitest (.test.ts extension)
- **dist/** - Build output (gitignored, generated by tsdown)

## Code Style & Conventions
- **TypeScript**: Strict mode, no unused locals, verbatimModuleSyntax enabled
- **Module System**: ESM only (`type: "module"`), platform neutral builds via tsdown
- **Build Tool**: tsdown with unbundle mode for better tree-shaking
- **Testing**: Vitest for unit tests
- **Imports**: Named exports preferred, use `export type` for types, no file extensions needed
- **Error Handling**: Use error factory pattern (createMirageError), include ERROR_CODES constants
- **Validation**: Use Zod schemas for runtime validation (e.g., mirageClientOptionsSchema)
- **WebRTC**: Implement proper connection lifecycle with error recovery
- **Events**: Use mitt for typed event emitters (connection state, errors)
- **Formatting**: Use Biome formatter (`pnpm format`), enforced formatting standards
- **Dependencies**: 
  - Runtime: mitt (events), p-retry (resilience), uuid (unique IDs), zod (validation)
  - Dev: tsdown (build), vitest (test), typescript, vite (examples), bumpp (releases)

## API Design Patterns
- **Factory Functions**: Use `create*` pattern for constructors (createMirageClient, createRealTimeClient)
- **Options Validation**: Validate all public API options with Zod schemas
- **Error Messages**: Provide clear, actionable error messages with specific error codes
- **Type Exports**: Export all public types alongside implementations
