<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decart SDK Proxy Example</title>
  <script type="importmap">
    {
      "imports": {
        "zod": "https://esm.sh/zod@4.0.17",
        "uuid": "https://esm.sh/uuid@13.0.0",
        "mitt": "https://esm.sh/mitt@3.0.1",
        "p-retry": "https://esm.sh/p-retry@6.2.1"
      }
    }
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 800px;
      width: 100%;
      padding: 40px;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 2rem;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 0.95rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 32px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      width: 100%;
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .status {
      margin-top: 20px;
      padding: 12px;
      border-radius: 8px;
      font-size: 0.9rem;
      display: none;
    }

    .status.info {
      background: #e3f2fd;
      color: #1976d2;
      border: 1px solid #90caf9;
    }

    .status.error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ef9a9a;
    }

    .status.success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #a5d6a7;
    }

    .result {
      margin-top: 30px;
      display: none;
    }

    .result img {
      width: 100%;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 10px;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ¨ Decart SDK Proxy Example</h1>
    <p class="subtitle">Generate images using the Decart SDK through a secure proxy</p>

    <form id="generateForm">
      <div class="form-group">
        <label for="prompt">Prompt</label>
        <input
          type="text"
          id="prompt"
          name="prompt"
          placeholder="A beautiful sunset over mountains"
          value="A beautiful sunset over mountains"
          required
        />
      </div>

      <button type="submit" id="generateBtn">
        Generate Image
      </button>
    </form>

    <div id="status" class="status"></div>

    <div id="result" class="result">
      <img id="resultImage" alt="Generated image" />
    </div>
  </div>

  <script type="module">
    // Import the SDK - served from node_modules by Express
    // The server serves packages/sdk/dist at /node_modules/@decartai/sdk
    // In production, you could use: import { createDecartClient, models } from 'https://cdn.jsdelivr.net/npm/@decartai/sdk@latest/dist/index.js';
    (async () => {
      let decartClient;
      let models;

      try {
        // Use absolute URL path - server serves packages/sdk/dist at /node_modules/@decartai/sdk
        const sdk = await import('/node_modules/@decartai/sdk/index.js');
        // Use relative path - works regardless of the server URL
        decartClient = sdk.createDecartClient({
          proxy: '/api/decart',
        });
        models = sdk.models;
      } catch (error) {
        console.error('Failed to load SDK:', error);
        const statusDiv = document.getElementById('status');
        statusDiv.textContent = `Error: Failed to load SDK. ${error.message}`;
        statusDiv.className = 'status error';
        statusDiv.style.display = 'block';
        return;
      }

      const form = document.getElementById('generateForm');
      const promptInput = document.getElementById('prompt');
      const generateBtn = document.getElementById('generateBtn');
      const statusDiv = document.getElementById('status');
      const resultDiv = document.getElementById('result');
      const resultImage = document.getElementById('resultImage');

      if (!form || !promptInput || !generateBtn || !statusDiv || !resultDiv || !resultImage) {
        console.error('Failed to find required DOM elements');
        return;
      }

      function showStatus(message, type) {
        statusDiv.textContent = message;
        statusDiv.className = `status ${type}`;
        statusDiv.style.display = 'block';
      }

      function hideStatus() {
        statusDiv.style.display = 'none';
      }

      function setLoading(loading) {
        generateBtn.disabled = loading;
        if (loading) {
          generateBtn.innerHTML = '<span class="loading"></span>Generating...';
        } else {
          generateBtn.textContent = 'Generate Image';
        }
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        e.stopPropagation();

        const prompt = promptInput.value.trim();
        if (!prompt) {
          showStatus('Please enter a prompt', 'error');
          return;
        }

        setLoading(true);
        hideStatus();
        resultDiv.style.display = 'none';

        try {
          showStatus('Generating image...', 'info');

          // Use the SDK to generate an image
          // The request goes to /api/decart, which the Express server proxies to api.decart.ai
          const blob = await decartClient.process({
            model: models.image('lucy-pro-t2i'),
            prompt: prompt,
          });

          // Create a URL for the blob and display it
          const url = URL.createObjectURL(blob);
          resultImage.src = url;
          resultDiv.style.display = 'block';

          showStatus('Image generated successfully!', 'success');
        } catch (error) {
          console.error('Error generating image:', error);
          showStatus(
            `Error: ${error instanceof Error ? error.message : 'Failed to generate image'}`,
            'error'
          );
        } finally {
          setLoading(false);
        }
      });
    })();
  </script>
</body>
</html>

